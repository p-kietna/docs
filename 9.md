Ah, I see â€” the error you're getting from `queue.push(...failed)` likely means that `failed` is not an array, but a single object or `undefined`. TypeScript is strict about this.

---

### âœ… Fix: Ensure `failed` is an Array

Hereâ€™s how to safely extract failed items using `Promise.allSettled`:

```ts
const results = await Promise.allSettled(
  chunk.map(async ({ partNumber, url }) => {
    const start = (partNumber - 1) * CHUNK_SIZE;
    const end = Math.min(start + CHUNK_SIZE, file.size);
    const part = file.slice(start, end);

    await axios.put(url, part, {
      signal,
      headers: {
        'Content-Type': file.type,
      },
    });
  })
);

// âœ… Filter out failed uploads
const failed = chunk.filter((_, i) => results[i].status === 'rejected');

// âœ… Reinsert failed files
if (failed.length > 0) {
  queue.push(...failed); // This works only if `failed` is a valid array
}
```

---

### ğŸ” Common Mistake

If you accidentally wrote:

```ts
const failed = results.find(r => r.status === 'rejected');
queue.push(...failed); // âŒ failed is not an array
```

That would cause the error you're seeing.

---

### ğŸ§  TypeScript Tip

Make sure `failed` is typed as:

```ts
const failed: { partNumber: number; url: string }[] = ...
```

If needed, cast it:

```ts
queue.push(...(failed as { partNumber: number; url: string }[]));
```

But only do this if you're confident in the structure.

---

Let me know if you want to add retry limits or track how many times each chunk has failed â€” I can help you build a smart retry system.