If you're building a file uploader in **Next.js**, especially for uploading multiple files in chunks, here's a clean and scalable way to approach both strategies you mentioned:

---

### ðŸ“¦ Strategy 1: Upload in Chunks, Retry Failed Files

#### âœ… Frontend (React + Next.js)

```tsx
const uploadFilesInChunks = async (files: File[], chunkSize = 10) => {
  let index = 0;

  while (index < files.length) {
    const chunk = files.slice(index, index + chunkSize);
    const results = await Promise.allSettled(
      chunk.map(file => uploadSingleFile(file))
    );

    // Filter out failed uploads
    const failedFiles = chunk.filter((_, i) => results[i].status === 'rejected');

    // Retry failed files in next chunk
    index += chunkSize - failedFiles.length;
    files.splice(index, 0, ...failedFiles); // re-insert failed files
  }
};

const uploadSingleFile = async (file: File) => {
  const formData = new FormData();
  formData.append('file', file);

  const res = await fetch('/api/upload', {
    method: 'POST',
    body: formData,
  });

  if (!res.ok) throw new Error('Upload failed');
};
```

---

### â³ Strategy 2: Wait for All to Succeed Before Next Chunk

```tsx
const uploadFilesSequentialChunks = async (files: File[], chunkSize = 10) => {
  for (let i = 0; i < files.length; i += chunkSize) {
    const chunk = files.slice(i, i + chunkSize);
    const results = await Promise.all(chunk.map(file => uploadSingleFile(file)));

    // Optionally check if all succeeded
    if (results.some(res => !res.ok)) {
      throw new Error('Chunk failed');
    }
  }
};
```

---

### ðŸ§  Backend (Next.js API Route)

In `app/api/upload/route.js` (Next.js 13+):

```js
import { NextResponse } from 'next/server';
import formidable from 'formidable';

export async function POST(req) {
  const form = formidable();
  const [fields, files] = await form.parse(req);
  console.log('Received file:', files.file.originalFilename);
  return NextResponse.json({ status: 'uploaded' });
}
```

> Note: Youâ€™ll need to configure `formidable` or `multer` and disable Next.jsâ€™s default body parser for file uploads.

---

Let me know if you want to add progress bars, drag-and-drop, or resumable uploads â€” I can help you build a slick uploader that feels fast and reliable.
