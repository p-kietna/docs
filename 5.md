To **reinsert failed files** into the upload queue using the `reduce` + `Promise.allSettled` pattern, you need to dynamically build new chunks that include previously failed files. Here's how to do it cleanly:

---

### ✅ Full Example: Reinsert Failed Files into Next Chunk

```ts
const uploadFilesInChunks = async (files: File[], chunkSize = 10) => {
  let queue = [...files]; // initial queue
  const failedFiles: File[] = [];

  while (queue.length > 0) {
    const chunk = queue.splice(0, chunkSize);

    const results = await Promise.allSettled(
      chunk.map(file => uploadSingleFile(file))
    );

    // Collect failed files
    const failed = chunk.filter((_, i) => results[i].status === 'rejected');

    if (failed.length > 0) {
      console.warn(`Retrying ${failed.length} failed files...`);
      // Reinsert failed files at the end of the queue
      queue.push(...failed);
    }
  }
};
```

---

### 🧠 What This Does

- Uploads files in chunks of `chunkSize`
- Tracks which files failed in each chunk
- Reinserts failed files at the end of the queue for retry
- Continues until all files are successfully uploaded

---

### 🔁 Optional: Limit Retry Attempts

To avoid infinite retries, you can track retry counts per file using a `Map<File, number>` and stop after N attempts.

Let me know if you want to add that logic or show progress in the UI — I can help you build a robust uploader with smart retries and feedback.