Great catch ‚Äî the `reduce`-based version I gave earlier **doesn‚Äôt include `Promise.allSettled` or `failedFiles` tracking**, because it assumes each chunk is uploaded sequentially and errors are handled inline. But if you want to **track which files failed** like in your original `uploadFilesInChunks` function, here‚Äôs how to adapt it:

---

### ‚úÖ Enhanced Version with `Promise.allSettled` and `failedFiles`

```ts
const uploadFilesInChunks = async (files: File[], chunkSize = 10) => {
  const chunks: File[][] = [];

  // Split files into chunks
  for (let i = 0; i < files.length; i += chunkSize) {
    chunks.push(files.slice(i, i + chunkSize));
  }

  const failedFiles: File[] = [];

  await chunks.reduce(async (prevPromise, chunk) => {
    await prevPromise;

    const results = await Promise.allSettled(
      chunk.map(file => uploadSingleFile(file))
    );

    // Track failed files
    results.forEach((result, i) => {
      if (result.status === 'rejected') {
        console.error(`Upload failed for ${chunk[i].name}`, result.reason);
        failedFiles.push(chunk[i]);
      }
    });
  }, Promise.resolve());

  if (failedFiles.length > 0) {
    console.warn(`Retrying ${failedFiles.length} failed files...`);
    // Optionally retry failed files here
  }
};
```

---

### üîç What This Adds

- Uses `Promise.allSettled` to capture both successes and failures
- Tracks failed files in a separate array
- Logs errors and gives you the option to retry them later

---

Let me know if you want to add retry logic with exponential backoff, progress bars, or a UI that shows which files failed and lets users retry manually.